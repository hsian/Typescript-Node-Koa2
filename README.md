# 新闻头条后台服务

## 启动

```shell
npm install or yarn install &
npm run start
```


## 统一说明

以下说明在本套接口中通用。



### 分页

> URL参数

| 参数      | 默认值 | 说明     |
| --------- | ------ | -------- |
| pageIndex | 1      | 当前页数 |
| pageSize  | 10     | 数据条数 |



> 例子

```
http://localhost:3000/list?pageIndex=1&pageSize=10
```



### 授权认证

> headers头信息参数

| 参数          | 默认值 | 说明                |
| ------------- | ------ | ------------------- |
| Authorization | 空     | 用户登录返回的token |



### 状态码

| 状态码 | 说明     |
| ------ | -------- |
| 200    | 成功     |
| 400    | 请求错误 |
| 401    | 未授权   |
| 403    | 没有权限 |



## 用户

### 登录

> 接口类型:【POST】
>
> 接口地址: 

```
/login
```



> 参数

| 参数     | 默认值 | 说明          | 必传 |
| -------- | ------ | ------------- | ---- |
| username | 空     | 用户名 / 手机 | 是   |
| password | 空     | 密码          | 是   |



### 注册

> 接口类型:【POST】
>
> 接口地址: 

```
/register
```



> 参数

| 参数     | 默认值 | 说明          | 必传 |
| -------- | ------ | ------------- | ---- |
| username | 空     | 用户名 / 手机 | 是   |
| password | 空     | 密码          | 是   |
| nickname | 空     | 昵称          | 是   |



### 用户详情

> 接口类型:【GET】
>
> 需要验证:【Authorization 】
>
> 接口地址: 

```
/user/:id
```



> URL动态参数

| 参数 | 默认值 | 说明   | 必传 |
| ---- | ------ | ------ | ---- |
| :id  | 空     | 用户id | 是   |



> 返回

用户详情对象

```js
{
    "message": "获取成功",
    "data": {
        "id": 1,						//  唯一id
        "username": "10086",			
        "password": "123",
        "nickname": "官方认证火星网友",
        "head_img": "",					// 头像
        "gender": 1,					// 性别，男1，女0
        "post_comments": 0,				// 发布评论条数
        "post_star": 0,					// 收藏文章条数
    }
}
```



### 编辑用户信息

> 接口类型:【POST】
>
> 需要验证:【Authorization 】
>
> 接口地址: 

```
/user_update/:id
```



> 参数

| 参数     | 默认值 | 必传 | 说明   |
| -------- | ------ | ---- | ------ |
| :id      | 空     | 是   | 用户id |
| username | 空     | 否   | 用户名 |
| password | 空     | 否   | 密码   |
| nickname | 空     | 否   | 昵称   |
| head_img | 空     | 否   | 头像   |
| gender   | 空     | 否   | 性别   |



> 返回

```js
{
    "message": "修改成功",
    "data": {}
}
```



### 关注用户

> 接口类型:【GET】
>
> 需要验证:【Authorization 】
>
> 接口地址: 

```
/user_follows/:id
```



> 参数

| 参数 | 默认值 | 必传 | 说明         |
| ---- | ------ | ---- | ------------ |
| :id  | 空     | 是   | 关注的用户id |



> 返回

```js
{
    "message": "关注成功"
}
```



### 取消关注用户

> 接口类型:【GET】
>
> 需要验证:【Authorization 】
>
> 接口地址: 

```
/user_unfollow/:id
```



> 参数

| 参数 | 默认值 | 必传 | 说明         |
| ---- | ------ | ---- | ------------ |
| :id  | 空     | 是   | 关注的用户id |



> 返回

```js
{
    "message": "取消关注成功"
}
```



### 用户关注列表

> 接口类型:【GET】
>
> 需要验证:【Authorization 】
>
> 接口地址: 

```
/user_follows
```



> 返回

```js
{
    "data": [
        {
            "id": 3,
            "username": "100862",
            "password": "123",
            "nickname": "娱乐在线",
            "head_img": "/uploads/image/IMG1568705287936.jpeg"
        }
    ]
}
```



### 用户评论列表

> 接口类型:【GET】
>
> 需要验证:【Authorization 】
>
> 接口地址: 

```
/user_comments
```



> 返回

```js
{
    "message": "",
    "data": [
        "id": 1,
        "content": "啊信是张信哲吗？张信哲是不是的张学友弟弟？",
        "post": {}
    ]
}
```



### 收藏文章列表

> 接口类型:【GET】
>
> 需要验证:【Authorization 】
>
> 接口地址: 

```
/user_star
```



> 返回

```js
{
    "message": "",
    "data": [
        {
            "id": 1,
            "title": "阿信分享《说好不哭》幕后故事：只听一次就配唱",
            "content": "",
            "type": 1,		// 文章类型
            "cover": [], 	// 封面
            "user": {},  	// 文章作者
            "comments": [] 	// 文章评论
        }
    ]
}
```



## 新闻文章

### 文章列表

> 接口类型:【GET】
>
> 需要验证:【Authorization 】（该接口不强制要求登录，但如果访问的是关注栏目，就必须要在头信息加上token）
>
> 接口地址: 

```
/post
```



> 参数

| 参数     | 默认值 | 必传 | 说明   |
| -------- | ------ | ---- | ------ |
| category | 空     | 否   | 栏目id |



> 例子

```
localhost:3000/post?pageIndex=1&pageSize=2&category=8
```



> 返回

```js
{
    "data": []
}
```



### 搜索文章

> 接口类型:【GET】
>
> 接口地址: 

```
/post_search
```



> 参数

| 参数    | 默认值 | 必传 | 说明       |
| ------- | ------ | ---- | ---------- |
| keyword | 空     | 否   | 搜索关键字 |



> 例子

```
localhost:3000/post_search?keyword=美女&pageIndex=1&pageSize=2
```



> 返回

```js
{
    "data": []
}
```



### 搜索推荐

> 接口类型:【GET】
>
> 接口地址: 

```
/post_search_recommend
```



> 参数

| 参数    | 默认值 | 必传 | 说明       |
| ------- | ------ | ---- | ---------- |
| keyword | 空     | 否   | 搜索关键字 |



> 例子

```
localhost:3000/post_search_recommend?keyword=美女
```



> 返回

```js
{
    "data": []
}
```



### 文章详情

> 接口类型:【GET】
>
> 接口地址: 

```
/post/:id
```



> 参数

| 参数 | 默认值 | 必传 | 说明   |
| ---- | ------ | ---- | ------ |
| :id  | 空     | 是   | 文章id |



> 例子

```
localhost:3000/post/1
```



> 返回

```js
{
    "data": {}
}
```



### 评论列表

> 接口类型:【GET】
>
> 接口地址: 

```
/post_comment/:id
```



> 参数

| 参数 | 默认值 | 必传 | 说明   |
| ---- | ------ | ---- | ------ |
| :id  | 空     | 是   | 文章id |



> 例子

```
localhost:3000/post_comment/1
```



> 返回

```js
{
    "data": []
}
```



### 发布评论

> 接口类型:【POST】
>
> 需要验证:【Authorization 】
>
> 接口地址: 

```
/post_comment/:id
```



> 参数

| 参数      | 默认值 | 必传 | 说明     |
| --------- | ------ | ---- | -------- |
| :id       | 空     | 是   | 文章id   |
| content   | 空     | 是   | 评论内容 |
| parent_id | 空     | 否   | 回复id   |



> 返回

```js
{
    "message": "评论发布成功"
}
```



### 收藏文章

> 接口类型:【GET】
>
> 需要验证:【Authorization 】
>
> 接口地址: 

```
/post_star/:id
```



> 参数

| 参数 | 默认值 | 必传 | 说明   |
| ---- | ------ | ---- | ------ |
| :id  | 空     | 是   | 文章id |



> 返回

```js
{
    "message": "收藏成功"
}
```



### 点赞文章

> 接口类型:【GET】
>
> 需要验证:【Authorization 】
>
> 接口地址: 

```
/post_like/:id
```



> 参数

| 参数 | 默认值 | 必传 | 说明   |
| ---- | ------ | ---- | ------ |
| :id  | 空     | 是   | 文章id |



> 返回

```js
{
    "message": "点赞成功"
}
```



### 发布文章

`管理后台使用`

> 接口类型:【POST】
>
> 需要验证:【Authorization 】
>
> 接口地址: 

```
/post
```



> 参数

| 参数       | 默认值 | 必传 | 说明             |
| ---------- | ------ | ---- | ---------------- |
| title      | 空     | 是   | 文章标题         |
| content    | 空     | 是   | 文章内容         |
| categories | 空数组 | 是   | 所属栏目ID集合   |
| cover      | 空数组 | 是   | 封面图片ID集合   |
| type       | 1      | 是   | 1为文章，2为视频 |



> 例子

```js
$.ajax({
    ...,
    data: {
    	title: "标题",
    	content: "内容",
    	categories: [
    		{id: 1},
            {id: 2}
    	],
       	cover: [
            {id: 8},
            {id: 9},
            {id: 10}
        ],
        type: 1
	}
})
```



> 返回

```js
{
    "message": "文章发布成功",
    "data": {}
}
```



### 编辑文章

`管理后台使用`

> 接口类型:【POST】
>
> 需要验证:【Authorization 】
>
> 接口地址: 

```
/post_update/:id
```



> 参数

| 参数       | 默认值 | 必传 | 说明             |
| ---------- | ------ | ---- | ---------------- |
| :id        | 空     | 是   | 文章             |
| title      | 空     | 否   | 文章标题         |
| content    | 空     | 否   | 文章内容         |
| categories | 空数组 | 否   | 所属栏目ID集合   |
| cover      | 空数组 | 否   | 封面图片ID集合   |
| type       | 1      | 否   | 1为文章，2为视频 |
| open       | 1      | 否   | 1为打开，0为关闭 |



> 返回

```js
{
    "message": "文章编辑成功",
}
```



## 文件上传

> 接口类型:【POST】
>
> 需要验证:【Authorization 】
>
> 接口地址: 

```
/upload
```



> 参数

| 参数 | 默认值 | 必传 | 说明     |
| ---- | ------ | ---- | -------- |
| file | 空     | 是   | 文件资源 |



> 返回

```js
{
    "message": "文件上传成功",
    "data": {
        "url": "/uploads/image/IMG1568820150584.jpeg",
        "uid": 11,
        "id": 11
    }
}
```



## 栏目

### 栏目列表

> 接口类型:【GET】
>
> 验证:【Authorization 】（该接口不强制要求登录，但是对于登录的用户，加上token信息会返回关注栏目）
>
> 接口地址: 

```
/category
```



> 字段说明

| 字段名 | 说明     |
| ------ | -------- |
| is_top | 是否热门 |



> 返回

```js
{
    "data": [
        {
            "id": 999,
            "name": "头条",
            "is_top": 1
        },
        {
            "id": 1,
            "name": "热点",
            "is_top": 1
        },
        {
            "id": 11,
            "name": "女人",
            "is_top": 0
        },
        
    ]
}
```



### 添加栏目

> 接口类型:【POST】
>
> 需要验证:【Authorization 】
>
> 接口地址: 

```
/category
```



> 参数

| 参数   | 默认值 | 必传 | 说明     |
| ------ | ------ | ---- | -------- |
| name   | 空     | 是   | 栏目名字 |
| is_top | 0      | 否   | 是否热门 |



> 返回

```js
{
    "message": "栏目添加成功",
}
```









